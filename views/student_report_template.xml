<odoo>
    <!-- Template del reporte PDF -->
    <template id="university.report_student_pdf">
        <t t-call="web.external_layout">
            <main class="page">
                <t t-foreach="docs" t-as="doc">
                    <div class="student-report">
                        <h2>Student Report</h2>

                        <p><strong>Name:</strong> <t t-esc="doc.name"/></p>
                        <p><strong>Address:</strong>
                            <t t-esc="doc.street"/>, <t t-esc="doc.city"/>,
                            <t t-esc="doc.state_id.name"/> <t t-esc="doc.zip"/>,
                            <t t-esc="doc.country_id.name"/>
                        </p>
                        <p><strong>University:</strong> <t t-esc="doc.university_id.name"/></p>

                        <!-- Tabla resumen de asignaturas -->
                        <h3>Summary of Subjects</h3>
                        <table class="table table-condensed">
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Professor</th>
                                    <th>Average Grade</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.enrollment_ids" t-as="enroll">
                                    <tr>
                                        <td><t t-esc="enroll.subject_id.name"/></td>
                                        <td><t t-esc="enroll.professor_id.name"/></td>
                                        <td>
                                            <t t-esc="enroll.grade_ids and sum([g.grade for g in enroll.grade_ids])/len(enroll.grade_ids) or 0.0"/>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>

                        <!-- Tabla completa de historial de notas -->
                        <h3>Complete Grade History</h3>
                        <table class="table table-condensed">
                            <thead>
                                <tr>
                                    <th>Subject</th>
                                    <th>Professor</th>
                                    <th>Grade</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="doc.grade_ids" t-as="g">
                                    <tr>
                                        <td><t t-esc="g.enrollment_id.subject_id.name"/></td>
                                        <td><t t-esc="g.enrollment_id.professor_id.name"/></td>
                                        <td><t t-esc="g.grade"/></td>
                                        <td><t t-esc="g.create_date"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </t>
            </main>
        </t>
    </template>

    <!-- Acción de reporte PDF -->
    <record id="action_student_report" model="ir.actions.report">
        <field name="name">Student Report</field>
        <field name="model">university.student</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">university.report_student_pdf</field>
        <field name="print_report_name">'Student - %s' % (object.name)</field>
    </record>

    <!-- Botón en formulario para imprimir -->
    <record id="view_university_student_form_report" model="ir.ui.view">
        <field name="name">university.student.form.report</field>
        <field name="model">university.student</field>
        <field name="inherit_id" ref="university.view_university_student_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button name="%(action_student_report)d"
                        string="Print PDF"
                        type="action"
                        class="oe_highlight"/>
            </xpath>
        </field>
    </record>
</odoo>
